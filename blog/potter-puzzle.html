<!doctype html>
<html lang="en">

<head>
    <title> Solving all 42 versions of the Harry Potter potions puzzle </title>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/pygments.css">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/img/favicon-16x16.png">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-147419708-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-147419708-1');
    </script>
</head>

<body>
    <header>
        <div class="banner"><h1>kevingal.com</h1></div>
        
        <nav>
        
            <a href="/index.html" class="navlink">home</a>
        
            <a href="/blog.html" class="navlink" id="active-page-navlink">blog</a>
        
            <a href="/apps.html" class="navlink">apps</a>
        
        </nav>
    </header>

<h2>Solving all 42 versions of the Harry Potter potions puzzle</h2>
<p>There's a neat little puzzle near the end of <em>Harry Potter and the Philosopher's Stone</em>. Harry and Hermione enter a chamber, the entrances are blocked by magic fire, and only by decoding the following riddle will they be able to escape:</p>
<div class="codehilite"><pre><span></span>  <span class="nv">Danger</span> <span class="nv">lies</span> <span class="nv">before</span> <span class="nv">you</span>, <span class="k">while</span> <span class="nv">safety</span> <span class="nv">lies</span> <span class="nv">behind</span>,
  <span class="nv">Two</span> <span class="nv">of</span> <span class="nv">us</span> <span class="nv">will</span> <span class="nv">help</span> <span class="nv">you</span>, <span class="nv">whichever</span> <span class="nv">you</span> <span class="nv">would</span> <span class="nv">find</span>,
  <span class="nv">One</span> <span class="nv">among</span> <span class="nv">us</span> <span class="nv">seven</span> <span class="nv">will</span> <span class="nv">let</span> <span class="nv">you</span> <span class="nv">move</span> <span class="nv">ahead</span>,
  <span class="nv">Another</span> <span class="nv">will</span> <span class="nv">transport</span> <span class="nv">the</span> <span class="nv">drinker</span> <span class="nv">back</span> <span class="nv">instead</span>,
  <span class="nv">Two</span> <span class="nv">among</span> <span class="nv">our</span> <span class="nv">number</span> <span class="nv">hold</span> <span class="nv">only</span> <span class="nv">nettle</span> <span class="nv">wine</span>,
  <span class="nv">Three</span> <span class="nv">of</span> <span class="nv">us</span> <span class="nv">are</span> <span class="nv">killers</span>, <span class="nv">waiting</span> <span class="nv">hidden</span> <span class="nv">in</span> <span class="nv">line</span>.
  <span class="nv">Choose</span>, <span class="nv">unless</span> <span class="nv">you</span> <span class="nv">wish</span> <span class="nv">to</span> <span class="nv">stay</span> <span class="nv">here</span> <span class="k">for</span> <span class="nv">evermore</span>,
  <span class="nv">To</span> <span class="nv">help</span> <span class="nv">you</span> <span class="nv">in</span> <span class="nv">your</span> <span class="nv">choice</span>, <span class="nv">we</span> <span class="nv">give</span> <span class="nv">you</span> <span class="nv">these</span> <span class="nv">clues</span> <span class="nv">four</span>:
  <span class="nv">First</span>, <span class="nv">however</span> <span class="nv">slyly</span> <span class="nv">the</span> <span class="nv">poison</span> <span class="nv">tries</span> <span class="nv">to</span> <span class="nv">hide</span>
  <span class="nv">You</span> <span class="nv">will</span> <span class="nv">always</span> <span class="nv">find</span> <span class="nv">some</span> <span class="nv">on</span> <span class="nv">nettle</span> <span class="nv">wine</span>’<span class="nv">s</span> <span class="nv">left</span> <span class="nv">side</span><span class="c1">;</span>
  <span class="nv">Second</span>, <span class="nv">different</span> <span class="nv">are</span> <span class="nv">those</span> <span class="nv">who</span> <span class="nv">stand</span> <span class="nv">at</span> <span class="nv">either</span> <span class="k">end</span>,
  <span class="nv">But</span> <span class="k">if</span> <span class="nv">you</span> <span class="nv">would</span> <span class="nv">move</span> <span class="nv">onwards</span>, <span class="nv">neither</span> <span class="nv">is</span> <span class="nv">your</span> <span class="nv">friend</span><span class="c1">;</span>
  <span class="nv">Third</span>, <span class="nv">as</span> <span class="nv">you</span> <span class="nv">see</span> <span class="nv">clearly</span>, <span class="nv">all</span> <span class="nv">are</span> <span class="nv">different</span> <span class="nv">size</span>,
  <span class="nv">Neither</span> <span class="nv">dwarf</span> <span class="nv">nor</span> <span class="nv">giant</span> <span class="nv">holds</span> <span class="nv">death</span> <span class="nv">in</span> <span class="nv">their</span> <span class="nv">insides</span><span class="c1">;</span>
  <span class="nv">Fourth</span>, <span class="nv">the</span> <span class="nv">second</span> <span class="nv">left</span> <span class="nv">and</span> <span class="nv">the</span> <span class="nv">second</span> <span class="nv">on</span> <span class="nv">the</span> <span class="nv">right</span>
  <span class="nv">Are</span> <span class="nv">twins</span> <span class="nv">once</span> <span class="nv">you</span> <span class="nv">taste</span> <span class="nv">them</span>, <span class="nv">though</span> <span class="nv">different</span> <span class="nv">at</span> <span class="nv">first</span> <span class="nv">sight</span>.
</pre></div>


<p><img alt="Some potions" src="/static/img/potter-puzzle/some-potions.png" /></p>
<p>Put simply, they have to figure out which potions are in which bottles.</p>
<p>In this post, we're going to solve all 42 possible versions of the puzzle via programming and create a nice little diagram of the results (like the picture above, but much bigger).</p>
<h3>Wait, why are there 42 versions?</h3>
<p>It's because the positions of the "giant" and "dwarf" potions are not specified. There are 7 possible positions for the giant, and for each of those, there are 6 remaining positions for the dwarf, which gives <code>7 * 6 = 42</code>. There's no way to know which one J.K. Rowling had in mind when she wrote the puzzle, unless she retcons it through Twitter. Until that inevitable day, we could pick a random version and have a crack at it. But, there's no guarantee that it would be solvable, hence why we're performing the public service of solving all 42 versions (or proving them unsolvable).</p>
<h3>JUST SOLVE IT</h3>
<p>First, here are the constraints of the puzzle, reworded in plainer terms:</p>
<ol>
<li>There are 2 harmless potions, 3 poison ones, 1 that lets you move forward and 1 that lets you move backward.</li>
<li>There is a poison potion directly to the left of both of the harmless potions.</li>
<li>The potions at the extreme ends are different, neither lets us move forward.</li>
<li>Neither the biggest nor the smallest potion is poisonous.</li>
<li>The second potion on the left and the second on the right have the same contents.</li>
</ol>
<p>How do we tackle it? Consider this version. Note that, as stated in the puzzle, there's 1 potion smaller than all the others (the dwarf) and 1 potion bigger than all the others (the giant).</p>
<p><img alt="Example version" src="/static/img/potter-puzzle/solve-1.png" /></p>
<p>Let's try using a dumb brute force search, i.e. taking the bottles one at a time and trying all of their possible contents.</p>
<p>The first bottle, for example, can't contain the move-forward potion because of constraint #3 (see above). Neither can it contain a harmless potion, due to constraint #2 -- it would be impossible for there to be a poison potion to its left. That leaves us with a poison potion and the move-backward potion as possible contents. We try both of these.</p>
<p>(Note: in the pictures that follow, green potions = poison, orange = harmless, blue = move-backward, purple = move-forward).</p>
<p><img alt="Example with first potion filled in" src="/static/img/potter-puzzle/solve-2.png" /></p>
<p><img alt="Example with first potion filled in" src="/static/img/potter-puzzle/solve-3.png" /></p>
<p>We repeat this process for both of the WIP (work in progress) solutions above, taking the second bottle and trying all valid contents. This gives us:</p>
<p><img alt="Example with second potion filled in" src="/static/img/potter-puzzle/solve-4a.png" /></p>
<p><img alt="Example with second potion filled in" src="/static/img/potter-puzzle/solve-4b.png" /></p>
<p><img alt="Example with second potion filled in" src="/static/img/potter-puzzle/solve-4c.png" /></p>
<p><img alt="Example with second potion filled in" src="/static/img/potter-puzzle/solve-4d.png" /></p>
<p>And eventually, by continuing like this and discarding WIP solutions if they reach a state where one of the bottles can't be filled without breaking a constraint, we end up with a single valid solution:</p>
<p><img alt="Solution of example" src="/static/img/potter-puzzle/some-potions.png" /></p>
<p>Of course, we weren't guaranteed to find a solution. There might have been no solution, or multiple solutions (and having multiple solutions is equivalent to the puzzle being unsolvable because you can't tell which is the correct one).</p>
<p>Applying our algorithm to all puzzle versions gives us the following solutions. 8 versions of the puzzle are solvable, 8 have no solutions and 26 have multiple solutions.</p>
<p><img alt="All solutions" src="/static/img/potter-puzzle/potions-puzzle-solutions.png" /></p>
<h3>A closer look at the solutions</h3>
<p>Is there something that all of the solvable variations of the puzzle have in common? Yes! Notice that either the small bottle or the big bottle have to be in 2nd or 6th position. This allows us to deduce that the 2nd and 6th bottles contain harmless potion, due to constraints #4 and #5. Without this deductive step, we can't eliminate the possibility that those bottles contain poison and we end up with multiple possible solutions. The solvable variations also require that the other "special" bottle (small or big) is in 3rd or 4th position. Otherwise, we can't pin down the exact location of the move-forward potion.</p>
<h3>Closing comments</h3>
<p>I leave you with a nice quote from the book.</p>
<blockquote>
<p>Hermione let out a great sigh and Harry, amazed, saw that she was smiling, the very last thing he felt like doing. ‘Brilliant,’ said Hermione. ‘This isn’t magic – it’s logic – a puzzle. A lot of the greatest wizards haven’t got an ounce of logic, they’d be stuck in here for ever.’</p>
</blockquote>
<p>...but wait! Maybe we can identify the canon version of the puzzle based on dialogue from the book.</p>
<blockquote>
<p>‘Got  it,’  she  said.  ‘The  smallest  bottle  will  get  us  through  the  black fire – towards the Stone.’ </p>
<p>...</p>
<p>‘Which one will get you back through the purple flames?’</p>
<p>Hermione pointed at a rounded bottle at the right end of the line.</p>
</blockquote>
<p>Drats. This still leaves multiple candidates. Get retconning, J.K.</p>
<h3>The code</h3>
<p>If you're curious about the code for solving the puzzles / drawing the diagram of solutions, see <a href="https://github.com/Kevinpgalligan/KevingalWebsite/blob/master/experiments/hp.py">HERE</a>.</p>
<hr>
<p><i>Post Date: 2019-10-03</i></p>
<div class="previous-page-link">
 Previous: <a href="/blog/emojipasta.html">The Tragic Story of u/AnEmojipastaBot</a>

</div>
<div class="next-page-link">
 <p>No next article.</p>

</div>


</body>
</html>